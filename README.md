# Course-Transaction-Analysis-
### Курсовая по 3 модулю. Работа с банковскими операциями, файлами и отчетностью.

## Описание
Вы будете разрабатывать приложение для анализа транзакций, которые находятся в Excel-файле. 
Приложение будет генерировать JSON-данные для веб-страниц, формировать Excel-отчеты, а также предоставлять другие сервисы.

## Информация для пользователей
### Данные
Файл с транзакциями пользователя хранится в папке data в формате Excel: [operations.xlsx](data/operations.xlsx)

```Описание данных
- Дата операции — дата, когда произошла транзакция.
- Дата платежа — дата, когда был произведен платеж.
- Номер карты — последние 4 цифры номера карты.
- Статус — статус операции (например, OK, FAILED).
- Сумма операции — сумма транзакции в оригинальной валюте.
- Валюта операции — валюта, в которой была произведена транзакция.
- Сумма платежа — сумма транзакции в валюте счета.
- Валюта платежа — валюта счета.
- Кешбэк — размер полученного кешбэка.
- Категория — категория транзакции.
- MCC — код категории транзакции (соответствует международной классификации).
- Описание — описание транзакции.
- Бонусы (включая кешбэк) — количество полученных бонусов (включая кешбэк).
- Округление на «Инвесткопилку» — сумма, которая была округлена и переведена на «Инвесткопилку».
- Сумма операции с округлением — сумма транзакции, округленная до ближайшего целого числа.
```

### В настоящее время реализовано несколько полезных функций для виджета:
+ в модуле **masks** реализована функция маскировки номера банковской карты и счета пользователя.
+ в модуле **widget** также доступна функция маски номера карты или счета, а также реализована функция форматирования даты и приведения её к виду `"ДД.ММ.ГГГГ"`.
+ в модуле **main** реализована головная функция, отвечающая за общую логику проекта, связывающая остальные функциональности между собой.

_Данные модули прошли проверку тестами на валидность и работоспособность!_


## Логирование
Добавлено сохранение логов в файл для модулей **masks**, **utils** и **read_files**.
Логи сохранены в директории _logs_ в корне проекта.

## Тестирование
В ходе тестирования кода был выполнен ряд проверок и отладки отдельных блоков:

**Модуль masks**  

Функция `get_mask_card_number`:
+ Правильность маскирования номера карты.
+ Параметризованные тесты для проверки работы функции на различных входных форматах номеров карт.
+ Обработка исключения _ValueError_ при случаях, когда номер карты введен некорректно или имеет неправильную длину, нулевое или строчное (буквенное) значение. 


### Общие аспекты тестирования
**Фикстуры.** 
Все фикстуры для тестов модулей проекта перенесены в единый модуль **conftest.py**

**Mock и patch**
Тестирование функции с обращением к API, а также чтение файлов в модуле **read_files** произведено с помощью декоратора patch.

**Покрытие тестами.** 
Все ветви кода и исключения, которые могут быть сгенерированы функциями, тестируются.
Покрытие тестами составляет 93% кода


## Документация
Узнать более подробно о проекте и реализованных функциях можно по следующим ссылкам:
- [функция маски](Homework_9.1.md)
- [виджет](Homework_9.2.md)
- [работа с банковскими операциями (сортировка по ключу и дате)](Homework_10.1.md)
- [генераторы](Homework_11.1.md)
- [тестировка функций](Homework_10.2.md)
- [декораторы](Homework_11.2.md)
- [импорт транзакций из json-файла и конвертация валютных сумм](Homework_12.1.md)
- [логи для masks и utils](Homework_12.2.md)
- [получение данных из csv-файла и excel-файла](Homework_13.1.md)
- [поиск по описанию и основная сборка проекта](Homework_13.2.md)

## Задание
Реализуйте на выбор минимум одну из задач в каждой категории.

```Задачи по категориям:
1. Веб-страницы:
   + Главная
   + События
2. Сервисы:
   + Выгодные категории повышенного кешбэка
   + Инвесткопилка
   + Простой поиск
   + Поиск по телефонным номерам
   + Поиск переводов физическим лицам
3. Отчеты:
   + Траты по категории
   + Траты по дням недели
   + Траты в рабочий/выходной день
```

#### Веб-страницы
Основные функции для генерации JSON-ответов реализуйте в отдельном модуле **views.py**.

1. **Главная**
Данные для анализа и вывода на веб-страницах — это данные с начала месяца, на который выпадает входящая дата, по входящую дату.
Если дата — `20.05.2020`, то данные для анализа будут в диапазоне `01.05.2020-20.05.2020`.

Валюты и акции для отображения на веб-страницах задаются в отдельном файле пользовательских настроек _user_settings.json_.
```
Пример:
{
  "user_currencies": ["USD", "EUR"],
  "user_stocks": ["AAPL", "AMZN", "GOOGL", "MSFT", "TSLA"]
}
```

Для получения данных о валютах и ценах на акции используйте библиотеку 
`requests`.
Сервисы, предоставляющие API для курса валют и цен на акции, подберите самостоятельно.

#### Сервисы
Реализуйте сервисы в отдельном модуле **services.py**.
При реализации сервисов должны использоваться элементы функционального программирования.

1. **Выгодные категории повышенного кешбэка**
Сервис позволяет проанализировать, какие категории были наиболее выгодными для выбора в качестве категорий повышенного кешбэка.
Напишите функцию для анализа выгодности категорий повышенного кешбэка. На вход функции поступают данные для анализа, год и месяц.

Входные параметры:
`data` — данные с транзакциями;
`year` — год, за который проводится анализ;
`month` — месяц, за который проводится анализ.

На выходе — JSON с анализом, сколько на каждой категории можно заработать кешбэка в указанном месяце года.

Выходные параметры
JSON с анализом, сколько на каждой категории можно заработать кешбэка.

```Формат выходных данных:
{
    "Категория 1": 1000,
    "Категория 2": 2000,
    "Категория 3": 500
}
```

2. **Инвесткопилка**
Позволяет копить через округление ваших трат.

Можно задать комфортный порог округления: 10, 50 или 100 ₽. Траты будут округляться, и разница между фактической суммой трат по карте и суммой округления будет попадать на счет «Инвесткопилки».
Пример

Вы настроили шаг округления 50 ₽. Покупка на 1712 ₽ автоматически округлится до 1750 ₽, и 38 ₽ попадут в «Инвесткопилку». Чем активнее расплачиваетесь картой, тем быстрее копятся деньги в копилке.

Функциональные требования:
Сервис должен предоставлять функцию 
investment_bank(month: str, transactions: List[Dict[str, Any]], limit: int) -> float
, которая возвращает сумму, которую удалось бы отложить в «Инвесткопилку».
Функция 
investment_bank
 должна принимать на вход три аргумента:
month
 — месяц, для которого рассчитывается отложенная сумма (строка в формате 'YYYY-MM').
transactions
 — список словарей, содержащий информацию о транзакциях, в которых содержатся следующие поля:
Дата операции
 — дата, когда произошла транзакция (строка в формате 'YYYY-MM-DD').
Сумма операции
 — сумма транзакции в оригинальной валюте (число).
limit
 — предел, до которого нужно округлять суммы операций (целое число).